<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Games - Embedded View</title>
  <style>
    /* Dark Theme Base */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background: #121212; color: white; overflow-x: hidden; }

    /* Search Bar Styling */
    .search-container {
        margin: 80px auto 20px;
        max-width: 600px;
        padding: 0 20px;
    }
    #gameSearch {
        width: 100%;
        padding: 12px 20px;
        background: #2c2c2c;
        border: 2px solid #444;
        border-radius: 4px;
        color: white;
        font-size: 16px;
        outline: none;
    }
    #gameSearch:focus { border-color: #4285f4; }

    /* Game Grid (The Image Theme) */
    .game-container {
        padding: 20px;
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        justify-content: center;
    }
    .game-card {
        background: white;
        color: black;
        padding: 15px 30px;
        cursor: pointer;
        font-weight: bold;
        text-transform: lowercase;
        border-radius: 2px;
        transition: transform 0.2s;
        min-width: 100px;
        text-align: center;
    }
    .game-card:hover { transform: translateY(-3px); background: #eee; }

    /* Embedding System (Iframe) */
    #gameView {
        display: none; /* Hidden until a game is clicked */
        position: fixed;
        top: 60px; /* Below header */
        left: 0;
        width: 100%;
        height: calc(100vh - 60px);
        background: black;
        z-index: 1000;
    }
    #gameIframe { width: 100%; height: 100%; border: none; }
    .close-btn {
        position: absolute;
        top: 10px;
        right: 20px;
        background: #ea4335;
        color: white;
        border: none;
        padding: 10px 15px;
        cursor: pointer;
        font-weight: bold;
        border-radius: 4px;
        z-index: 1001;
    }

    /* Reuse your Header/Sidebar CSS here (Omitted for brevity, keep what you have) */
    .header { position: fixed; top: 0; width: 100%; height: 60px; background: #1a1a1a; display: flex; align-items: center; padding: 0 20px; z-index: 1100; border-bottom: 1px solid #333; }
  </style>
</head>
<body>

  <div class="header">
    <div style="cursor:pointer; font-size:24px;" onclick="toggleSidebar()">☰</div>
    <div style="margin-left:auto; display:flex; align-items:center; gap:10px;">
        <div id="userAvatar" style="width:35px; height:35px; background:#4285f4; border-radius:50%; display:flex; justify-content:center; align-items:center;">U</div>
    </div>
  </div>

  <div class="search-container">
    <input type="text" id="gameSearch" placeholder="Search games..." onkeyup="filterGames()">
  </div>

  <div class="game-container" id="gameGrid"></div>

  <div id="gameView">
    <button class="close-btn" onclick="closeGame()">✕ Close Game</button>
    <iframe id="gameIframe" src=""></iframe>
  </div>

  <script>
    let allGames = []; // Global store for searching

    async function loadGames() {
        const grid = document.getElementById('gameGrid');
        try {
            const response = await fetch('games.json');
            allGames = await response.json();
            renderGames(allGames);
        } catch (e) {
            grid.innerHTML = "Error loading games.";
        }
    }

    function renderGames(gamesList) {
        const grid = document.getElementById('gameGrid');
        grid.innerHTML = '';
        
        gamesList.forEach(game => {
            let displayLabel = (game.label || 'game').toLowerCase();
            if (displayLabel.startsWith('cl')) {
                displayLabel = displayLabel.slice(2);
            }

            const btn = document.createElement('div');
            btn.className = 'game-card';
            btn.innerText = displayLabel;
            btn.onclick = () => openGame(game.path);
            grid.appendChild(btn);
        });
    }

    // Non-case sensitive search
    function filterGames() {
        const query = document.getElementById('gameSearch').value.toLowerCase();
        const filtered = allGames.filter(game => {
            let label = game.label.toLowerCase();
            if (label.startsWith('cl')) label = label.slice(2);
            return label.includes(query);
        });
        renderGames(filtered);
    }

    // Embed logic
    function openGame(path) {
        const view = document.getElementById('gameView');
        const iframe = document.getElementById('gameIframe');
        iframe.src = path;
        view.style.display = 'block';
        document.body.style.overflow = 'hidden'; // Stop scrolling background
    }

    function closeGame() {
        const view = document.getElementById('gameView');
        const iframe = document.getElementById('gameIframe');
        iframe.src = ''; // Stop game audio/logic
        view.style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    window.onload = loadGames;
  </script>
</body>
</html>
